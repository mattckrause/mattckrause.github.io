
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="/theme/pygments/monokai.min.css">



  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/solid.css">


  <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon">
  <link rel="icon" href="images/favicon.png" type="image/x-icon">


  <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Matt Krause Atom">



 

<meta name="author" content="Matt Krause" />
<meta name="description" content="Microsoft Copilot is a useful piece of technology. Having a large language model (LLM) grounded in your Microsoft 365 data brings clear benefits. But it’s important to recognize that not all your data lives within your M365 tenant. That’s where Copilot extensibility steps in. It gives you the …" />
<meta name="keywords" content="">


  <meta property="og:site_name" content="Matt Krause"/>
  <meta property="og:title" content="My Adventure in Building a Custom Copilot Connector - Part 1"/>
  <meta property="og:description" content="Microsoft Copilot is a useful piece of technology. Having a large language model (LLM) grounded in your Microsoft 365 data brings clear benefits. But it’s important to recognize that not all your data lives within your M365 tenant. That’s where Copilot extensibility steps in. It gives you the …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="/drafts/my-adventure-in-building-a-custom-copilot-connector-part-1.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2025-07-16 22:36:05.686000+00:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="/author/matt-krause.html">
  <meta property="article:section" content="blog"/>
  <meta property="og:image" content="/images/MKLogo.png">

  <title>Matt Krause &ndash; My Adventure in Building a Custom Copilot Connector - Part 1</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="/">
      <img src="/images/MKLogo.png" alt="Matt Krause" title="Matt Krause">
    </a>

    <h1>
      <a href="/">Matt Krause</a>
    </h1>

    <p>Matt Krause's personal blog</p>


    <nav>
      <ul class="list">


            <li>
              <a target="_self"
                 href="/pages/about.html#about">
                About Me
              </a>
            </li>

      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-bluesky"
           href="https://bsky.app/profile/mattckrause.com"
           target="_blank">
          <i class="fa-brands fa-bluesky"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://www.github.com/mattckrause"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/matthew-krause/"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="/">Home</a>

  <a href="/archives.html">Archives</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>

  <a href="/feeds/all.atom.xml">Atom</a>

</nav>

<article class="single">
  <header>
      
    <h1 id="my-adventure-in-building-a-custom-copilot-connector-part-1">My Adventure in Building a Custom Copilot Connector - Part 1</h1>
    <p>
      Posted on Wed 16 July 2025 in <a href="/category/blog.html">blog</a>

    </p>
  </header>


  <div>
    <p>Microsoft Copilot is a useful piece of technology. Having a large language model (LLM) grounded in your Microsoft 365 data brings clear benefits. But it’s important to recognize that not all your data lives within your M365 tenant. That’s where Copilot extensibility steps in. It gives you the ability to expand Copilot’s functionality in a few key ways.</p>
<p>At a high level, Copilot extensibility lets you expand either the knowledge (the data Copilot is grounded on) or the skills (the tasks Copilot can perform). Copilot connectors (previously Graph connectors) allow you to extend Copilot’s knowledge, while plugins can extend both knowledge and actions. Each option has its pros and cons, and there are definitely scenarios where one solution makes more sense than the other, but I’ll save a detailed comparison for another post.</p>
<p>For now, I want to focus on Copilot connectors. More specifically, building my own custom connector to ingest some external content.</p>
<p>Believe it or not, I’m <strong>NOT</strong> a developer. So when I started this journey, I couldn’t just dive in and build a connector from scratch. I had to take it step by step. Fortunately, I am comfortable with PowerShell and familiar with Graph APIs, so that’s where I began. As a learning exercise, it turned out to be a great approach. It allowed me to build incrementally on what I already knew and ultimately get a simple connector up and running in my dev environment.</p>
<h2>Copilot Connector Initial Goal</h2>
<p>To keep things manageable, I started with a simple plan:</p>
<ul>
<li>Identify the specific APIs and permissions required.</li>
<li>Break the process down into minimal steps and build using PowerShell.</li>
<li>Deploy the Copilot connector.</li>
</ul>
<p>In additional blog posts, I'll document a more indepth process including things like:</p>
<ul>
<li>Migrating to a programming language to add more functionality.</li>
<li>Hosting the solution in Azure App Services.</li>
<li>Building a deployment process.</li>
</ul>
<h2>Getting started</h2>
<p>This was pretty simple as the connector development process is pretty well documented. Using <a href="https://learn.microsoft.com/graph/connecting-external-content-build-quickstart">this documentation</a>, I simplified the processes to 3 core steps:</p>
<ol>
<li><a href="https://learn.microsoft.com/graph/api/externalconnectors-external-post-connections?view=graph-rest-1.0&amp;tabs=http">Create an external connection</a></li>
<li><a href="https://learn.microsoft.com/graph/api/externalconnectors-externalconnection-patch-schema?view=graph-rest-1.0&amp;tabs=http">Register the schema</a></li>
<li><a href="https://learn.microsoft.com/graph/api/externalconnectors-externalconnection-put-items?view=graph-rest-1.0&amp;tabs=http">Write the objects to the connection.</a></li>
</ol>
<p>In order to build using Microsoft Graph, we need to authenticate using the correct permissions. We can do this by <a href="https://learn.microsoft.com/entra/identity-platform/quickstart-register-app?tabs=certificate%2Cexpose-a-web-api">creating an app registration</a> through Microsoft Entra and using that information as part of our authentication flow.</p>
<p>The important bits here are:</p>
<ul>
<li>
<h2>Application (client) ID</h2>
</li>
</ul>
<p>You will get this automatically once the app registration process is complete. It can be found in the <em>Overview</em> section on the left.</p>
<ul>
<li>
<h2>Certificates &amp; secrets</h2>
</li>
</ul>
<p>You'll need to create either the certificate or secret here, depending on how you want to authenticate. You can use PowerShell to create <a href="https://learn.microsoft.com/powershell/module/pki/new-selfsignedcertificate?view=windowsserver2025-ps">self-signed certificates</a> for use with the Graph PowerShell SDK.</p>
<ul>
<li>
<h2>API Permissions</h2>
</li>
</ul>
<p>You'll need to ensure you have the correct permissions assigned <strong>AND</strong> consented to. The required permissions (from documentation above) are:</p>
<ul>
<li>ExternalConnection.ReadWrite.OwnedBy</li>
<li>ExternalItem.ReadWriet.OwnedBy</li>
</ul>
<p><img alt="Image showing the required Graph permissions shown in the app registration including that they have been granted admin consent" src="/drafts/images/1-perms.png"></p>
<h2>The PowerShell Commands</h2>
<p>The <a href="https://learn.microsoft.com/powershell/microsoftgraph/installation?view=graph-powershell-1.0">Graph PowerShell SDK</a> provides an easy method to authenticate using the Entra app registreation previously created. For security purposes, I use a .env file to hold my auth data so I don't store any credentials in plain text. I've included two code snippets to show authentication using both Certificates and secrets. The snippets read the .env file and passes the appID, tenantID and certificate thumbprint/client secret to the <strong>Connect-MgGraph</strong> cmdlet:</p>
<div class="highlight"><pre><span></span><code><span class="c">#Authentication using Certificate</span>
<span class="nv">$data</span> <span class="p">=</span> <span class="nb">get-content</span> <span class="n">-Path</span> <span class="p">.</span><span class="n">env</span>
<span class="nv">$appID</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">))[</span><span class="n">1</span><span class="p">]</span>
<span class="nv">$tenantID</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">))[</span><span class="n">1</span><span class="p">]</span>
<span class="nv">$authCertThumb</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="n">2</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">))[</span><span class="n">1</span><span class="p">]</span>

<span class="nb">Connect-MgGraph</span> <span class="n">-ClientId</span> <span class="nv">$appID</span> <span class="n">-TenantId</span> <span class="nv">$tenantID</span> <span class="n">-CertificateThumbprint</span> <span class="nv">$authCertThumb</span> <span class="n">-nowelcome</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c">#Authentication using client secret</span>
<span class="nv">$data</span> <span class="p">=</span> <span class="nb">get-content</span> <span class="n">-Path</span> <span class="p">.</span><span class="n">env</span>
<span class="nv">$appID</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">))[</span><span class="n">1</span><span class="p">]</span>
<span class="nv">$tenantID</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">))[</span><span class="n">1</span><span class="p">]</span>
<span class="nv">$clientSecret</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="n">2</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">))[</span><span class="n">1</span><span class="p">]</span>

<span class="nv">$securedPassword</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="p">`</span>
<span class="n">-String</span> <span class="nv">$clientSecret</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span>

<span class="nv">$clientsecretCredential</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="p">`</span>
<span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span> <span class="p">`</span>
<span class="n">-ArgumentList</span> <span class="nv">$appID</span><span class="p">,</span> <span class="nv">$securedPassword</span>

<span class="nb">Connect-MgGraph</span> <span class="n">-TenantId</span> <span class="nv">$tenantID</span> <span class="n">-ClientSecretCredential</span> <span class="nv">$clientsecretCredential</span> <span class="n">-nowelcome</span>
</code></pre></div>

<p>Once successfully authenticated, you can verify the session permissions by running the <strong>Get-MgContext</strong> cmdlet ensuring you see the permissions consented to previously:</p>
<p><img alt="Results from the PowerShell Get-MGContext cmdlet" src="/drafts/images/1-get_mgcontext.png"></p>
<p>Now that you have successfuly authenticated, the next step is to creat the external connection. Think of this as an empty container that will eventually hold the Schema configuration and the ingested external items. The necessary cmdlet from the Graph PowerShell SDK is <strong>New-MgExternalConnection</strong>. You'll need to pass in three values: the Name, ID, and Description for the Copilot Connector:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$connectionName</span> <span class="p">=</span> <span class="s2">&quot;TestCopilotConnector&quot;</span>
<span class="nv">$connectionParams</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">id</span> <span class="p">=</span> <span class="nv">$ConnectionName</span>
    <span class="n">name</span> <span class="p">=</span> <span class="nv">$ConnectionName</span>
    <span class="n">description</span> <span class="p">=</span> <span class="s2">&quot;Test connector called $ConnectionName. Containing a list of company names.&quot;</span>
<span class="p">}</span>

<span class="nb">New-MgExternalConnection</span> <span class="n">-BodyParameter</span> <span class="nv">$connectionParams</span>
</code></pre></div>

<p>With the external connection created, the next step is to define the schema and update the external connection with that schema data:</p>
<div class="highlight"><pre><span></span><code><span class="c">#create schema</span>
<span class="nv">$connectionName</span> <span class="p">=</span> <span class="s2">&quot;TestCopilotConnector&quot;</span>

<span class="nv">$schemaParams</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">baseType</span> <span class="p">=</span> <span class="s2">&quot;microsoft.graph.externalItem&quot;</span>
    <span class="n">properties</span> <span class="p">=</span> <span class="p">@(</span>
        <span class="p">@{</span>
            <span class="n">name</span> <span class="p">=</span> <span class="s2">&quot;CompanyName&quot;</span>
            <span class="nb">type </span><span class="p">=</span> <span class="s2">&quot;String&quot;</span>
            <span class="n">isSearchable</span> <span class="p">=</span> <span class="s2">&quot;true&quot;</span>
            <span class="n">isRetrievable</span> <span class="p">=</span> <span class="s2">&quot;true&quot;</span>
            <span class="n">labels</span> <span class="p">=</span> <span class="p">@(</span>
            <span class="s2">&quot;title&quot;</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="nb">Update-MgExternalConnectionSchema</span> <span class="n">-ExternalConnectionId</span> <span class="nv">$ConnectionName</span> <span class="n">-BodyParameter</span> <span class="nv">$schemaParams</span>
</code></pre></div>

<p>⭐⭐ <strong>It should be noted at this point that the Schema creation process can take between 5 and 15 minutes. The documentation recomends using the location response header to get the current status of the schema creation operation</strong> ⭐⭐</p>
<p>With the first two steps complete, you have the shell of a Copilot connector and are ready to write items. Rather than connect to an actual external API, to keep this first attempt simple, I used Copilot to create a .CSV list of fictional companies with a discription for each. The script reads that .CSV file and creates new items for each object, mapping properties to the simple schema I created, using a GUID as the item ID and setting the ACL to allow access for everyone:</p>
<div class="highlight"><pre><span></span><code><span class="nb">Import-Csv</span> <span class="n">-Path</span> <span class="s2">&quot;C:\github\MyScripts\GraphAPI\PS_SDK\ExternalItems\fictitious_companies.csv&quot;</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
        <span class="nv">$params</span> <span class="p">=</span> <span class="p">@{</span>
            <span class="n">acl</span> <span class="p">=</span> <span class="p">@(</span>
                <span class="p">@{</span>
                    <span class="nb">type </span><span class="p">=</span> <span class="s2">&quot;everyone&quot;</span>
                    <span class="n">value</span> <span class="p">=</span> <span class="s2">&quot;everyone&quot;</span>
                    <span class="n">accessType</span> <span class="p">=</span> <span class="s2">&quot;grant&quot;</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">properties</span> <span class="p">=</span> <span class="p">@{</span>
                <span class="n">CompanyName</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">name</span>
            <span class="p">}</span>
            <span class="n">content</span> <span class="p">=</span> <span class="p">@{</span>
                <span class="n">value</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">description</span>
                <span class="nb">type </span><span class="p">=</span> <span class="s2">&quot;text&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="nb">Set-MgExternalConnectionItem</span> <span class="n">-ExternalConnectionId</span> <span class="s2">&quot;test&quot;</span> <span class="n">-ExternalItemId</span> <span class="p">(</span><span class="nb">New-Guid</span><span class="p">)</span> <span class="n">-BodyParameter</span> <span class="nv">$params</span>
<span class="p">}</span>
</code></pre></div>

<h2>Conclusion</h2>
<p>Obviously, this isn't intended to be a full blown Copilot connector. But it does provide the general process and it should help you to get your own Copilot connector up and running with relatively little effort. I have used PowerShell scripts based on this learning a handful of times to help get samples up and running quickly for testing and demos. I am providing a <a href="https://github.com/mattckrause/MSGraph/tree/Main/ExternalItems">sample script</a> I've written as an example of how you might put it all together. As previously mentioned, this is the first post of a series where I build upon these learning to create a Copilot connector using Python that is hosted in Azure app services and enabled for Copilot consumption.</p>
  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>






</article>

<footer>
<p>&copy;  </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Matt Krause ",
  "url" : "",
  "image": "/images/MKLogo.png",
  "description": "Matt Krause's personal blog"
}
</script>
</body>
</html>